apiVersion: v1
data:
  run.sh: |-
    #!/bin/bash

    set -eu

    copySecrets() {
      local artifactory_home=/opt/jfrog/artifactory

      mkdir -p ${artifactory_home}/var/etc/security

      cp /run/secrets/artifactory/jcr/join.key ${artifactory_home}/var/etc/security/join.key
      cp /run/secrets/artifactory/jcr/master.key ${artifactory_home}/var/etc/security/master.key

      cp /run/secrets/artifactory/jcr/system.yaml ${artifactory_home}/var/etc/system.yaml

      chown -R "${JF_ARTIFACTORY_USER}":"${JF_ARTIFACTORY_USER}" ${artifactory_home}/var
    }

    copySecrets
    /entrypoint-artifactory.sh
kind: ConfigMap
metadata:
  annotations:
    use-subpath: "true"
  labels:
    io.kompose.service: artifactory-jcr
  name: artifactory-jcr-entrypoint-cm
